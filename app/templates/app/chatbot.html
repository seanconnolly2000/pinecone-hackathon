  {% csrf_token %}
<style>
/* define the styles for the chatbot popup */
.chatbot-popup {
  position: fixed;
  bottom: 10px;
  right: 10px;
  width: 600px;
  height: 400px;
  border: 1px solid #ccc;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

/* define the styles for the chatbot header */
.chatbot-header {
  height: 40px;
  background-color: #7fbadc;
  color: #fff;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  display: flex;
  align-items: center;
}

/* define the styles for the chatbot title */
.chatbot-title {
  font-weight: bold;
  margin-left: 10px;
}

/* define the styles for the chatbot close button */
.chatbot-close {
  margin-left: auto;
  margin-right: 10px;
  cursor: pointer;
}

/* define the styles for the chatbot content */
.chatbot-content {
  height: calc(100% - 100px);
  overflow-y: auto;
  background-color: #fff;
  color: #808080;
}

/* define the styles for the chatbot messages */
.chatbot-message {
  margin: 5px;
}

/* define the styles for the user messages */
.user-message {
  text-align: right;
}

/* define the styles for the bot messages */
.bot-message {
  color: #0026ff;
}

/* define the styles for the chatbot input */
.chatbot-input {
  width: 100%;
  height: 60px;
  background-color: #7fbadc;
  color: #fff;
  border-bottom-left-radius: 10px;
  border-bottom-right-radius: 10px;
}

/* define the styles for the chatbot input field */
.chatbot-input-field {
  width: calc(100% - 20px);
  max-width: inherit;
  height: auto;
  margin: 2px;
  border: 0px;
  resize: none;
}
</style>
<!-- create a div element for the chatbot popup -->
<div id="chatbot-popup" class="chatbot-popup ui-widget-content" >
  
<!-- create a div element for the chatbot header -->
<div class="chatbot-header">
  
<!-- create a span element for the chatbot title -->
<span class="chatbot-title">SharkBot Corporate Data Chatbot</span>
<span><img src="/static/app/tiburon.svg" style="width:30px; margin-left:50px;" /></span>

<!-- create a span element for the chatbot close button -->
<span class="chatbot-close" onclick="closeChat()">X</span>

</div>

<!-- create a div element for the chatbot content -->
<div class="chatbot-content" id="chatbot-content">

</div>

<!-- create a div element for the chatbot input -->
<div class="chatbot-input">

<!-- create an input element for the chatbot input field -->
<textarea class="chatbot-input-field" id="chatbot-input-field" placeholder="Type your message here..." rows=2 onkeydown="sendChat(event)" ></textarea>

</div>

</div>
<script>
    window.onload = function (e) {
        $(".chatbot-popup").draggable({
            handle: ".chatbot-header",
            start: function (event, ui) {
                $(this).css('margin-right', '');
                $(this).css('margin-left', '');
            }
        });

        $(".chatbot-popup").resizable();
        var content = document.getElementById("chatbot-content");
        var botDiv = document.createElement("div");

        // Add the message and bot classes to the div element
        botDiv.classList.add("chatbot-message", "bot-message");

        // Set the text content of the div element to the bot message
        botDiv.textContent = "Hello, {{ user.first_name }}, how can I help? 😊";

        // Append the div element to the messages element
        content.appendChild(botDiv);




    }

    // define a function to close the chatbot popup
    function closeChat() {
        // get the chatbot popup element
        var popup = document.querySelector(".chatbot-popup");
        // hide the popup element
        popup.style.display = "none";
    }

    // define a function to send a chat message
    function sendChat(event) {
        // check if the enter key was pressed
        if (event.keyCode == 13) {
            // get the chatbot input field element
            var input = document.getElementById("chatbot-input-field");
            // get the value of the input field
            var message = input.value.trim();
            // Clear the input field
            input.value = "";
            input.focus();
            input.setSelectionRange(0, 0); 

            // check if the message is not empty
            if (message) {
                // get the chatbot content element
                var content = document.getElementById("chatbot-content");
                // create a div element for the user message
                var userMessage = document.createElement("div");
                // set the class of the user message element
                userMessage.className = "chatbot-message user-message";
                // set the text of the user message element
                userMessage.textContent = message;
                // append the user message element to the content
                content.appendChild(userMessage);
                // Scroll to the bottom of the messages element
                content.scrollTop = content.scrollHeight;

               // eq = "/echo/" + encodeURIComponent(message);
                let ul = document.getElementById('result');

                var botMessage = null;

                fetch('/chat/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ 'message': message })
                })
                    .then(response => response.json())
                    .then(data => {
                        botMessage = data.reply;
                        // Create a new div element to display the bot message
                        var botDiv = document.createElement("div");

                        // Add the message and bot classes to the div element
                        botDiv.classList.add("chatbot-message", "bot-message");

                        // Set the text content of the div element to the bot message
                        botDiv.textContent = botMessage;

                        // Append the div element to the messages element
                        content.appendChild(botDiv);

                        // Scroll to the bottom of the messages element
                        content.scrollTop = content.scrollHeight;
                    })
                    .catch(error => {
                        alert( "Error: " + error.message);
                    });               

            }
        }
    }
</script>